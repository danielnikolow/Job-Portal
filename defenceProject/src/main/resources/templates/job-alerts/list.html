<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Alerts – Управление на известия | JobPortal</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/job-alerts.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="job-alerts-page">
<header class="alerts-header">
    <div class="container">
        <div class="header-content">
            <div class="header-text">
                <div class="breadcrumbs">
                    <a th:href="@{/user-home}">Начало</a>
                    <span>/</span>
                    <span>Job Alerts</span>
                </div>
                <h1>Моите Job Alerts</h1>
                <p class="subtitle">Управлявай известията за нови подходящи обяви</p>
            </div>
            <div class="header-actions">
                <form th:action="@{/job-alerts/trigger-matching}" method="post" style="display: inline-block; margin-right: 10px;">
                    <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}">
                    <button type="submit" class="btn-secondary" title="Задействай matching процеса ръчно">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                        </svg>
                        <span>Matching</span>
                    </button>
                </form>
                <a th:href="@{/job-alerts/create}" class="btn-primary">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"/>
                    </svg>
                    <span>Създай нов Alert</span>
                </a>
            </div>
        </div>
    </div>
</header>

<main class="alerts-main container">
    <!-- Flash Messages -->
    <div th:if="${success}" class="alert alert-success">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
        <span th:text="${success}">Успешно!</span>
    </div>
    <div th:if="${error}" class="alert alert-error">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span th:text="${error}">Грешка!</span>
    </div>

    <!-- Alerts List -->
    <section class="alerts-list" th:if="${alerts != null && !#lists.isEmpty(alerts)}">
        <div class="alerts-grid">
            <article class="alert-card" th:each="alert : ${alerts}">
                <div class="alert-card-header">
                    <div class="alert-title-section">
                        <h3 th:text="${alert.desiredPosition ?: 'Всички позиции'}">Java Developer</h3>
                        <div class="alert-badges">
                            <span class="badge" th:classappend="${alert.active ? 'badge-active' : 'badge-inactive'}"
                                  th:text="${alert.active ? 'Активен' : 'Неактивен'}">Активен</span>
                            <span class="badge badge-frequency" th:text="${alert.frequency}">INSTANT</span>
                        </div>
                    </div>
                    <div class="alert-actions">
                        <form th:action="@{/job-alerts/{id}/toggle(id=${alert.id})}" method="post" style="display: inline;">
                            <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}">
                            <button type="submit" class="btn-icon" th:title="${alert.active ? 'Деактивирай' : 'Активирай'}">
                                <svg th:if="${alert.active}" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 6L6 18M6 6l12 12"/>
                                </svg>
                                <svg th:unless="${alert.active}" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </button>
                        </form>
                        <form th:action="@{/job-alerts/{id}/delete(id=${alert.id})}" method="post" style="display: inline;" 
                              onsubmit="return confirm('Сигурни ли сте, че искате да изтриете този alert?');">
                            <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}">
                            <button type="submit" class="btn-icon btn-icon-danger" title="Изтрий">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                            </button>
                        </form>
                    </div>
                </div>

                <div class="alert-card-body">
                    <div class="alert-criteria">
                        <div class="criterion" th:if="${alert.experienceLevel}">
                            <span class="criterion-label">Ниво:</span>
                            <span class="criterion-value" th:text="${alert.experienceLevel}">SENIOR</span>
                        </div>
                        <div class="criterion" th:if="${alert.location}">
                            <span class="criterion-label">Локация:</span>
                            <span class="criterion-value" th:text="${alert.location}">София</span>
                        </div>
                        <div class="criterion" th:if="${alert.workMode}">
                            <span class="criterion-label">Режим:</span>
                            <span class="criterion-value" th:text="${alert.workMode}">REMOTE</span>
                        </div>
                        <div class="criterion" th:if="${alert.minSalary}">
                            <span class="criterion-label">Мин. заплата:</span>
                            <span class="criterion-value" th:text="${alert.minSalary + ' лв.'}">5000 лв.</span>
                        </div>
                        <div class="criterion">
                            <span class="criterion-label">Мин. score:</span>
                            <span class="criterion-value" th:text="${alert.minScore + '/100'}">60/100</span>
                        </div>
                    </div>

                    <div class="alert-skills" th:if="${alert.requiredSkills != null && !#lists.isEmpty(alert.requiredSkills)}">
                        <span class="skills-label">Умения:</span>
                        <div class="skills-tags">
                            <span class="skill-tag" th:each="skill : ${alert.requiredSkills}" th:text="${skill}">Java</span>
                        </div>
                    </div>

                    <div class="alert-settings">
                        <div class="setting-item">
                            <span class="setting-label">Канал:</span>
                            <span class="setting-value" th:text="${alert.notifyChannel}">BOTH</span>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">Честота:</span>
                            <span class="setting-value" th:text="${alert.frequency}">INSTANT</span>
                        </div>
                    </div>
                </div>

            </article>
        </div>
    </section>

    <!-- Empty State -->
    <section class="empty-state" th:if="${alerts == null || #lists.isEmpty(alerts)}">
        <div class="empty-content">
            <div class="empty-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                </svg>
            </div>
            <h3>Все още нямаш Job Alerts</h3>
            <p>Създай първия си alert, за да получаваш известия за подходящи обяви.</p>
            <div class="empty-actions">
                <a th:href="@{/job-alerts/create}" class="btn-primary">Създай Job Alert</a>
            </div>
        </div>
    </section>
</main>

</body>
</html>
